//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
// Auteur               : Bigonoff                                                      //
// URL                  : www.bigonoff.org                                              //
//////////////////////////////////////////////////////////////////////////////////////////
// Historique                                                                           //
// ----------                                                                           //
// V1.01    04/01/2018  : Prise en charge des 24LC256, 512 et 1025 (Koala)              //
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
// Licence d'utilisation                                                                //
// ---------------------                                                                //
// Ce document est fourni tel quel, sans aucune garantie et sans recours d'aucune sorte //
// Vous avez le droit d'utiliser et/ou de modifier ce document dans le cadre d'une      //
// ainsi que l'identification du modificateur.                                          //
// d'utilsation.                                                                        //
// officiels. Toute ressemblance avec un document existant ne serait que pure           //
//////////////////////////////////////////////////////////////////////////////////////////

#include <lpc17xx.h>
#include "LPC17xx_Bits.h"
#include "Eeprom.h"
#include "I2C.h"
#include "Timing.h"

//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
//                               VARIABLES GLOBALES                                     //
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////////////
//                                  PROTOTYPES                                          //
//////////////////////////////////////////////////////////////////////////////////////////

static __inline Boolean BeginTransmission(uint16_t MemoryAddress, Boolean Mode);
    
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
//                               FONCTIONS PUBLIQUES                                    //
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////
//                                  SELECTION DE L'EEPROM                               //
//////////////////////////////////////////////////////////////////////////////////////////
//----------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------
void Eeprom_SelectChip(uint8_t EepromAddress, uint8_t EepromCapability)
{
}

//////////////////////////////////////////////////////////////////////////////////////////
//                                      LECTURE D'UN OCTET                              //
//////////////////////////////////////////////////////////////////////////////////////////
//----------------------------------------------------------------------------------------
// Retourne         : La valeur de l'octet lu
//----------------------------------------------------------------------------------------
uint8_t Eeprom_ReadByte(uint16_t MemoryAddress)
{
    uint8_t value;                                                       // Octet lu
    
        return false;                                                    // Echec
    
    return value;                                                        // Retourne l'octet lu
}

//////////////////////////////////////////////////////////////////////////////////////////
//                                       ECRIRE UN OCTET                                //
//////////////////////////////////////////////////////////////////////////////////////////
//----------------------------------------------------------------------------------------
// Retourne           : true ou false
//----------------------------------------------------------------------------------------
Boolean Eeprom_WriteByte(uint16_t MemoryAddress, uint8_t Data)
{
    
        return false;                                                     // Echec
    
}

//////////////////////////////////////////////////////////////////////////////////////////
//                                       LIRE PLUSIEURS OCTETS                          //
//////////////////////////////////////////////////////////////////////////////////////////
//----------------------------------------------------------------------------------------
// Array               : Tableau qui va contenir les valeurs lues
// ArraySize           : Taille du tableau
// Retourne            : true ou false
//----------------------------------------------------------------------------------------
Boolean Eeprom_ReadBytesArray(uint16_t MemoryAddress, uint8_t *Array, uint8_t ArraySize)
{
    uint8_t i;                                                             // Variable pour la boucle for
    
        return false;                                                      // Echec
    
        Array[i] = I2C_Read(i != (ArraySize - 1));                         // Lecture et place dans le tableau de retour
    
    return true;                                                           // Ok
}

//////////////////////////////////////////////////////////////////////////////////////////
//                                    ECRIRE PLUSIEURS OCTETS                           //
//////////////////////////////////////////////////////////////////////////////////////////
//----------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------
// ArraySize            : Taille du tableau
// Retourne             : true ou false
//----------------------------------------------------------------------------------------
Boolean Eeprom_WriteBytesArray(uint16_t MemoryAddress, uint8_t *Array, uint8_t ArraySize)
{
    uint8_t i;                                                              // Variable pour la boucle for
    
    switch(_selectedEepromCapability)
    {
        case 8:
            break;
        case 64:
            break;
        case 128:
                break;
    }
    
        return false;                                                       // Echec
    
        I2C_Write(Array[i]);                                                // Ecriture
    
    
    // VERIFICATION
    // ------------
        return false;                                                       // Echec
    
    {
        if(I2C_Read(i < (ArraySize - 1)) != Array[i])                       // Lecture et comparaison
        {
            return false;                                                                                           
        }
    }
    return true;                                                                                                    
}

//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////
//                                     GESTION DU CONTROLE                              //
//////////////////////////////////////////////////////////////////////////////////////////
//----------------------------------------------------------------------------------------
// Retourne             : true ou false
//----------------------------------------------------------------------------------------
static __inline Boolean BeginTransmission(uint16_t MemoryAddress, Boolean Mode)
{
    
    for(timeout=0; timeout<8; timeout++)
    {
        {
            // Toutes les 24LCxx ont un adressage sur 16 bits sauf la 24LC02 que j'identifie par la taille de sa page 
            if(_selectedEepromCapability > 8)                                // Si autre qu'une 24LC02
            
            if(result)                                                       // Ok
            {
                if(result)                                                   // Ok
                    break;                                                   // On sort de la boucle
            }
        }
    }
    
    if(!result)                                                              // Si il y a eu un erreur dans le traitement ci-dessus
    {
        return false;                                                        // Echec
    }
    
        
}
